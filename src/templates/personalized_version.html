{% extends "layout.html" %}
{% block content %}
<h2>Personalized UI Version</h2>

{% if feedback %}
  <div class="alert alert-info">{{ feedback }}</div>
  <a class="btn btn-primary" href="{{ url_for('quiz_bp.personalized_version') }}">Try Another Snippet</a>
{% else %}
  <p class="text-muted">Missed Songs in DB: {{ missed_count }}</p>

  {% if song %}
    <!-- Minimal cover-art embed with hidden track info -->
    <div class="mb-3">
      <iframe
        src="https://open.spotify.com/embed/track/{{ song.id }}?theme=0&view=coverart"
        width="300"
        height="300"
        allow="encrypted-media"
        frameborder="0"
        style="border:none;overflow:hidden"
      ></iframe>
    </div>

    {% if show_hints %}
      <div class="alert alert-warning">
        <strong>Hint:</strong>
        {% set ctype = session.challenge_type %}
        {% if ctype == 'artist' %}
          The artistâ€™s name starts with <b>{{ song.artist[0] }}</b>.
        {% elif ctype == 'title' %}
          The title starts with <b>{{ song.title[0] }}</b>.
        {% else %}
          The release year is in the <b>{{ (song.year // 10) * 10 }}s</b>.
        {% endif %}
      </div>
    {% endif %}

    <form method="POST" action="{{ url_for('quiz_bp.submit_guess') }}">
      {% set ctype = session.challenge_type %}
      {% if ctype == 'title' %}
        <p>Guess the <strong>Song Title</strong>:</p>
        <input type="text" name="guess" id="guess" class="form-control" required>
      {% elif ctype == 'year' %}
        <p>Guess the <strong>Release Year</strong>:</p>
        <input type="text" name="guess" class="form-control" required>
      {% else %}
        <p>Guess the <strong>Artist</strong>:</p>
        <input type="text" name="guess" id="guess" class="form-control" required>
      {% endif %}
      <input type="hidden" name="source_page" value="personalized">
      <button class="btn btn-success mt-2">Submit Guess</button>
    </form>
  {% else %}
    <p><em>No track available.</em></p>
  {% endif %}
{% endif %}
{% endblock %}
